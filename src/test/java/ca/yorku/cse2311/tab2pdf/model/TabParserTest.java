package ca.yorku.cse2311.tab2pdf.model;

import org.junit.Before;
import org.junit.Test;

import java.util.Arrays;
import java.util.List;

import ca.yorku.cse2311.tab2pdf.parser.TabParser;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;

/**
 * TabParserTest
 *
 * Tests TabParser.
 *
 * @author Marco Cirillo
 * @since 2015-02-03
 */
public class TabParserTest {

    /* These are sample title, subtitle, spacing, scaling lines */
    public static final String TITLE_LINE = "TITLE=Moonlight Sonata";
    public static final String SUBTITLE_LINE = "SUBTITLE=Ludwig van Beethoven";
    public static final String SPACING_LINE = "SPACING=5.0";
    public static final String SCALING_LINE = "SCALING=5.0";

    /**
     * An entire tab, line by line 
     */
    public static final String[] LINES = {
            "TITLE=Moonlight Sonata"
            , "SUBTITLE=Ludwig van Beethoven"
            , "SPACING=5.0"
            , ""
            , "|-------------------------|-------------------------|"
            , "|-----1-----1-----1-----1-|-----1-----1-----1-----1-|"
            , "|---2-----2-----2-----2---|---2-----2-----2-----2---|"
            , "|-2-----2-----2-----2-----|-2-----2-----2-----2-----|"
            , "|-0-----------------------|-------------------------|"
            , "|-------------------------|-3-----------------------|"
            , ""
            , "|-------------------------|-------------------------|"
            , "|-----1-----1-----3-----3-|-----3-----1-----0-----0-|"
            , "|---2-----2-----3-----3---|---1-----2-----2-----1---|"
            , "|-3-----3-----3-----3-----|-2-----2-----2-----0-----|"
            , "|-------------5-----------|-------------------------|"
            , "|-1-----------------------|-0-----------0-----------|"
            , ""
            , "|-------------------0----0|-0-----------------0----0|"
            , "|-----------1-----1-----1-|-----3-----3-----3-----3-|"
            , "|-2---2---2-----2-----2---|---4-----4-----4-----4---|"
            , "|-2-2---2-----2-----2-----|-------2-----2-----2-----|"
            , "|-0-----------------------|-------------------------|"
            , "|-------------------------|-0-----------------------|"
            , ""
            , "|-0-----------1-----------|-0-----------------3-----|"
            , "|-----1-----1-----3-----3-|-----1-----1-3---0-----0-|"
            , "|---2-----2-----2-----2---|---0-----0-----0-----0---|"
            , "|-2-----2-----0-----3-----|-2-----2-----3-----3-----|"
            , "|-0-----------------------|-------------------------|"
            , "|-------------------------|-3-----------3-----------|"
            , ""
            , "|-------------------------|--------------------------|"
            , "|-1---1-----1-----1-----1-|--------------------------|"
            , "|---0-----0-----0-----0---|-----5-----5-----5-8---5-8|"
            , "|-2-----2-----2-----2-----|---5-----5-----5-----5----|"
            , "|-3-----------------------|-6-----6-----6-----6------|"
            , "|-------------------------|-8------------------------|"
            , ""
            , "|-------------------------|-------------------------|"
            , "|-4-----------------4----4|-4---------------1-3---1-|"
            , "|-----6-----6-----6-----6-|-----5-----5---2-----2---|"
            , "|---5-----5-----5-----5---|---6-----6---1-----0-----|"
            , "|-------6-----6-----6-----|-6-----6-----------------|"
            , "|-6-----------------------|-4-----3-----2-----------|"
            , ""
            , "|-------------------------|-------------------------|"
            , "|-3-----------4-----1-----|-3-----------3-----------|"
            , "|-----3-----3---0-2---0-2-|-----3-----3-----2-----2-|"
            , "|---5-----5---1-----1-----|---5-----5-----4-----4---|"
            , "|-5-----5-----3-----------|-5-----5-----5-----5-----|"
            , "|-3-----------------------|-------------------------|"
            , ""
            , "|-------------------3-----|s4-----------------2-----|"
            , "|-----3-----3-----3-----3-|-----4-----4-----4-----4-|"
            , "|---3-----3-----4-----4---|---5-----5-----5-----5---|"
            , "|-5-----5-----5-----5-----|-5-----5-----5-----------|"
            , "|-------------------------|-------3-----------3-----|"
            , "|-3-----------------------|-------------------------|"
            , ""
            , "|-3-----------------3-----|s4-----------------2-----|"
            , "|-----3-----3-----3-----3-|-----4-----4-----4-----4-|"
            , "|---4-----4-----4-----4---|---5-----5-----5-----5---|"
            , "|-5-----5-----5-----5-----|-5-----5-----5-----------|"
            , "|-------------------------|-------3-----------3-----|"
            , "|-3-----------------------|-------------------------|"
            , ""
            , "|-3-----------3-----------|-3---0-----0-1-----------|"
            , "|-----3-----3-------------|-----------------3-----3-|"
            , "|---4-----4-----3-6---3-6-|---2-----2-----2-----2---|"
            , "|-5-----5-----5-----5-----|-------5-----0-----3-----|"
            , "|-------------------------|-4-----------------------|"
            , "|-3-----------0-----------|-------------------------|"
            , ""
            , "|-------------------------|-------------------------|"
            , "|-4-----------3-----------|-------------------------|"
            , "|-----3-----3-----4-----4-|-------------2-----2-----|"
            , "|---5-----5-----3-----3---|-7---3-----3-----2-----2-|"
            , "|-------6-----5-----5-----|---5-----5-----5-----4---|"
            , "|-3-----------4-----------|-5-----5-----5-----5-----|"
            , ""
            , "|-------------------5----5|-5-------0-----0---5----5|"
            , "|-----------------6-----6-|---5-8-----8-----8---5-8-|"
            , "|-----------7---7-----7---|-------------------------|"
            , "|-----7---7---7-----7-----|-7-----7-----7-----7-----|"
            , "|---8---8-----------------|-0-----------------------|"
            , "|-10----------------------|-------------------------|"
            , ""
            , "|-5-----------------5-----|-7---0-----0-----0-7---0-|"
            , "|-----6-----6-9---------6-|-------------------------|"
            , "|---7-----7-----7-9---7---|---7-----7-----7-----7---|"
            , "|-7-----7-----------7-----|-6-----6-----6-----6-----|"
            , "|-5-----------------------|-------------------------|"
            , "|-------------7-----5-----|-4-----------------4-----|"
            , ""
            , "|-8------------7-----5-----|-4-----------------------|"
            , "|-----10----10-0---9-----7-|-------5-----6---0-----0-|"
            , "|---9-----9------7-----5---|-----4-----4-------7-----|"
            , "|-10----10-----0-----7-----|---6-----6-----6-----6---|"
            , "|-0------------------6-----|-------------------------|"
            , "|--------------------------|-0-----------------------|"
            , ""
            , "|-------------------------|-------5-----8-----5-----|"
            , "|-----0-----0-----0-----0-|-----5-----5-----5-----5-|"
            , "|-------------------------|-5-5-----5-----5-----5---|"
            , "|---6-----6-----6-----6---|-------------------------|"
            , "|-------7-----8-----5-----|-------------------------|"
            , "|-0-----------------------|-0-----------------------|"
            , ""
            , "|-------------------------|-------------------1---4-|"
            , "|-------------1-----------|-----------0---3-0---3---|"
            , "|-------2-----------2-----|-------1-----1-----------|"
            , "|-----2-----2-----2-----2-|---3-0---3---------------|"
            , "|-3-3-----3-----3-----3---|-2-----------------------|"
            , "|-0-----------------------|-0-----------------------|"
            , ""
            , "|-----------0--s5---8-5---|-----------------------2-|"
            , "|-------1-----1s--5-----5-|---------------1---4-1---|"
            , "|---2-----2---------------|-----------2-----2-------|"
            , "|-----2-------------------|---1---4-1---4-----------|"
            , "|-3-----------------------|-0---3-------------------|"
            , "|-0-----------------------|-0-----------------------|"
            , ""
            , "|-------------------4---7-|s4---1-------------------|"
            , "|-------0-----0-6-----6---|---3---0-3---0-----------|"
            , "|---1-------7-----7-------|-----------1-----1-------|"
            , "|-0---3--s6---------------|---------------3---0-3---|"
            , "|-------------------------|-----------------------2-|"
            , "|-0-----------------------|-------------------------|"
            , ""
            , "|-------------------------|-------------------------|"
            , "|-------------------------|-------------------------|"
            , "|-------------------------|-------------------------|"
            , "|-0---------0-3---0---0-3-|-----2-3-2-----0-3---0-3-|"
            , "|-----2---------2---0-----|---5-------5-2-----0-----|"
            , "|---4---1-4---------------|-4-----------------------|"
            , ""
            , "|-------------------------|-------------------------|"
            , "|-------------------------|-------------------------|"
            , "|-------------------------|-----------------2-----2-|"
            , "|-----2-3-2-----0-3---0-3-|-----2-3-2---------------|"
            , "|---5-------5-1-----0-----|---5-------5-0h3---0h3---|"
            , "|-4-----------------------|-4-----------1-----------|"
            , ""
            , "|-------------------------|-------------------0----0|"
            , "|-------------------------|-----------1-----1-----1-|"
            , "|-----2-----2-----1-----1-|-2---2---2-----2-----2---|"
            , "|-0h3-----3-----2-----2---|---2---2-----2-----2-----|"
            , "|-2-----2-----2-----2-----|-0-----------------------|"
            , "|-------------0-----------|-------------------------|"
            , ""
            , "|-0-----------------0----0|-0-----------1-----------|"
            , "|-----3-----3-----3-----3-|-----1-----1-----3-----3-|"
            , "|---4-----4-----4-----4---|---2-----2-----2-----2---|"
            , "|-------2-----2-----2-----|-2-----2-----0-----3-----|"
            , "|-------------------------|-0-----------------------|"
            , "|-0-----------------------|-------------------------|"
            , ""
            , "|-0-----------------3-----|-------------------3----3|"
            , "|-----1-----1-3---0-----0-|-----------5-----5-----5-|"
            , "|---0-----0-----0-----0---|-5---5---5-----5-----5---|"
            , "|-2-----2-----3-----3-----|---5---5-----5-----5-----|"
            , "|-------------------------|-3-----------------------|"
            , "|-3-----------3-----------|-------------------------|"
            , ""
            , "|-3---1-----1-----1-3---1-3|-3---0-----0-4---0-5-----|"
            , "|---3-----3-----3-----3----|---1-----1-----3-------5-|"
            , "|-0-----0-----0-----0------|-0-----0-------------5---|"
            , "|--------------------------|-------------------7-----|"
            , "|-2------------------------|-3-----------2-----0-----|"
            , "|--------------------------|-------------------------|"
            , ""
            , "|-7---0-----0-8-----------|-6-----------4---0-----0-|"
            , "|-0-----0---------10----10|---3-6---3-6---3-----3---|"
            , "|---7-----7-----9-----9---|-3-----3-----1-----1-----|"
            , "|-------------10----10----|-0-----------------------|"
            , "|-------------0-----------|-------------------------|"
            , "|-4-----------------------|-------------0-----------|"
            , ""
            , "|-5-----------------5-----|-6-----------------4---1-|"
            , "|-----5-----5-----5-----5-|-----6-----6-----6---3---|"
            , "|---5-----5-----6-----6---|---7-----7-----7---2-----|"
            , "|-7-----7-----7-----7-----|-7-----7-----7-----0-----|"
            , "|-0-----------------------|-------5-----3-----------|"
            , "|-------------------------|-------------------------|"
            , ""
            , "|-5-----------------5-----|-6-----------------4---1-|"
            , "|-----5-----5-----5-----5-|-----6-----6-----6---3---|"
            , "|---6-----6-----6-----6---|---7-----7-----7---2-----|"
            , "|-7-----7-----7-----7-----|-7-----7-----7-----0-----|"
            , "|-0-----------------------|-------5-----3-----------|"
            , "|-------------------------|-------------------------|"
            , ""
            , "|-5-----------5-----------|-3---1-----1-----1-3---0-|"
            , "|-----5-----5-----6-----6-|---3-----3-----3-----1---|"
            , "|---6-----6-----7-----7---|-0-----0-----0-----------|"
            , "|-7-----7-----7-----7-----|-------------------------|"
            , "|-------------5-----------|-2-----------------3-----|"
            , "|-5-----------------------|-------------------------|"
            , ""
            , "|-1---0-1-----------0-----|-------------0-----1-----|"
            , "|---1-----0-3-5---------1-|-3---0-----0-----0-----0-|"
            , "|---------------4-7---2---|---2-----2-----2-----2---|"
            , "|-3-----3-----6-----2-----|-0-----0-----2-----0-----|"
            , "|-0-----2-----------0-----|-------------------------|"
            , "|-------------4-----------|-1-----------0-----------|"
            , ""
            , "|-0-----------0-----------|-------------------------|"
            , "|-----1-----1-----0-----0-|-1---------1-----1-----1-|"
            , "|---2-----2-----1-----1---|-----2---2-----2-----2---|"
            , "|-2-----2-----0-----0-----|-2-2---2-----2-----2-----|"
            , "|-------------------------|-0-----------------------|"
            , "|-0-----------0-----------|-------------------0----0|"
            , ""
            , "|-------------------------|-----------5---8-5-12-8---|"
            , "|-----3-----3-----3-----3-|-------5-----5----------10|"
            , "|---4-----4-----4-----4---|---5-----5----------------|"
            , "|-2-----2-----2-----2-----|-----7--------------------|"
            , "|-------------------------|-7------------------------|"
            , "|-4-----------------0----0|-5-----------------0-----0|"
            , ""
            , "|---7---------------------|-----------5---8-5-12-8---|"
            , "|-9-----9-----------------|-------5-----5----------10|"
            , "|-----10--7-10--7---------|---5-----5----------------|"
            , "|-------------9----s6---0-|-7---7--------------------|"
            , "|-----------------8---7---|-7------------------------|"
            , "|-0-----------------0----0|-5-----------------0-----0|"
            , ""
            , "|---7---------------------|-------------------------|"
            , "|-9-----9-----------------|-------------------------|"
            , "|-----10--7-10--7---------|-------5-----------2-----|"
            , "|-------------9----s6---0-|-7---7---7-------2---2---|"
            , "|-----------------8---7---|-7-7-------7---3-------3-|"
            , "|-0-----------------0----0|-5-----------5-----------|"
            , ""
            , "|-------0-----------------|-------------5-----------|"
            , "|-----1---1---------------|-------------5-----------|"
            , "|---2-------2---2---------|-------------5-----------|"
            , "|-2-----------2---2---2---|-------------7-----------|"
            , "|-0-----------------3---3-|p0-----------0-----------|"
            , "|-------------------------|-------------------------|"
            , ""
            , "|-------------------------|"
            , "|-------------------------|"
            , "|-------------------------|"
            , "|-7-----------------------|"
            , "|-0-----------------------|"
            , "|-------------------------|"
            , ""
    };

    private TabParser parser;

    @Before
    public void setUp() {

        parser = new TabParser();
    }

    @Test
    public void testParse() {

        // Running our sample tab shouldn't throw an exception
        // This test should be sufficient (and we won't have to hardcode a Tab object!)
        TabParser.parse(Arrays.asList(LINES));
    }

    /**
     * Tests parseLine() with valid input
     */
    @Test
    public void testParseLine() throws Exception {

        for (String line : LINES) {  // Go through all the valid lines

            // This will hold line that we converted back to tab using the ITabNotations toString()
            String parsedLine = "";

            //TODO: Fix tester since the way it works is different now. (The parser treats each bar as objects)
            for (List<ITabNotation> noteSet : TabParser.parseLine(line)) {  // Go through all the parsed tokens (notes)
                        if (parsedLine.endsWith("|")) {
                                parsedLine = parsedLine.substring(0, parsedLine.length() - 1);
                        }
                        for (ITabNotation note : noteSet) {

                                parsedLine += note.toString();  // Convert token back to tab notation
                        }
                }

            // the line the parser parsed and the original line better be the same!
            assertEquals(line, parsedLine);
        }

    }
    
    @Test
    public void testIsTitleLine() {
        assertTrue(TabParser.isTitleLine(TITLE_LINE));
        assertTrue(!TabParser.isTitleLine(SUBTITLE_LINE));
        assertTrue(!TabParser.isTitleLine(SPACING_LINE));
        assertTrue(!TabParser.isTitleLine(SCALING_LINE));
    }

    @Test
    public void testIsSubtitleLine() {
        assertTrue(TabParser.isSubtitleLine(SUBTITLE_LINE));
        assertTrue(!TabParser.isSubtitleLine(TITLE_LINE));
        assertTrue(!TabParser.isSubtitleLine(SPACING_LINE));
        assertTrue(!TabParser.isSubtitleLine(SCALING_LINE));
    }
    
    @Test
    public void testIsSpacingLine() {
        assertTrue(TabParser.isSpacingLine(SPACING_LINE));
        assertTrue(!TabParser.isSpacingLine(TITLE_LINE));
        assertTrue(!TabParser.isSpacingLine(SUBTITLE_LINE));
        assertTrue(!TabParser.isSpacingLine(SCALING_LINE));       
    }

    @Test
    public void testGetTitle() {
        assertEquals(TITLE_LINE, TabParser.getTitle(Arrays.asList(LINES)).toString());
    }

    @Test
    public void testGetSubtitle() {
        assertEquals(SUBTITLE_LINE, TabParser.getSubtitle(Arrays.asList(LINES)).toString());
    }

    @Test
    public void testGetSpacing() {
        assertEquals(SPACING_LINE, TabParser.getSpacing(Arrays.asList(LINES)).toString());
    }
}
